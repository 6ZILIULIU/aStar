window.__require=function t(r,i,e){function n(c,s){if(!i[c]){if(!r[c]){var a=c.split("/");if(a=a[a.length-1],!r[a]){var l="function"==typeof __require&&__require;if(!s&&l)return l(a,!0);if(o)return o(a,!0);throw new Error("Cannot find module '"+c+"'")}}var h=i[c]={exports:{}};r[c][0].call(h.exports,function(t){return n(r[c][1][t]||t)},h,h.exports,t,r,i,e)}return i[c].exports}for(var o="function"==typeof __require&&__require,c=0;c<e.length;c++)n(e[c]);return n}({A_asterisk:[function(t,r,i){"use strict";cc._RF.push(r,"ef58c7bb/9MgJPP5GKBlMGQ","A_asterisk"),Object.defineProperty(i,"__esModule",{value:!0});var e=cc._decorator,n=e.ccclass,o=e.property,c=function(t){function r(){var r=null!==t&&t.apply(this,arguments)||this;return r.ctxCanvas=null,r.startPointBtn=null,r.endPointBtn=null,r.wallPointBtn=null,r.calculatePathBtn=null,r.clearWallBtn=null,r.count=0,r.rows=20,r.cols=20,r.ctx=null,r.gridSize=null,r.gridArray=[],r.startPoint=null,r.endPoint=null,r.playSpeed=0,r}return __extends(r,t),r.prototype.onLoad=function(){window.canvasScript=this,console.log("this.gridArray",this.gridArray);var t=new cc.Node("ctx");t.parent=this.ctxCanvas,t.position=cc.v2(0,0);var r=t.addComponent(cc.Graphics);r.lineWidth=5,r.strokeColor=cc.color(0,0,255),r.fillColor=cc.color(0,0,0),this.ctx=r,this.gridArray=[];for(var i=0;i<this.rows;i++){for(var e=[],n=0;n<this.cols;n++){e.push({type:"none"})}this.gridArray.push(e)}this.ctxCanvas.setContentSize(.7*cc.winSize.width,cc.winSize.height),this.gridSize=cc.size(this.ctxCanvas.width/this.cols,this.ctxCanvas.height/this.rows),this.startPoint=cc.v2(2,10),this.endPoint=cc.v2(18,10),this.init()},r.prototype.init=function(){for(var t=this,r=0;r<this.gridArray.length;r++)for(var i=0;i<this.gridArray[r].length;i++){var e=new cc.Vec2(r*this.gridSize.width,i*this.gridSize.height),n=this.gridArray[r][i];n.pos=e,n.row=r,n.col=i,this.startPoint&&r==this.startPoint.x&&this.startPoint.y==i&&(n.type="startPoint"),this.endPoint&&r==this.endPoint.x&&this.endPoint.y==i&&(n.type="endPoint")}this.updateGrids(),this.startPointBtn.on(cc.Node.EventType.TOUCH_START,function(){console.log("setStartPointBtn"),t.node.targetOff(t),t.node.on(cc.Node.EventType.TOUCH_START,this.setStartPoint,t),t.node.on(cc.Node.EventType.TOUCH_MOVE,this.setStartPoint,t)},this),this.endPointBtn.on(cc.Node.EventType.TOUCH_START,function(){console.log("setEndPointBtn"),t.node.targetOff(t),t.node.on(cc.Node.EventType.TOUCH_START,this.setEndPoint,t),t.node.on(cc.Node.EventType.TOUCH_MOVE,this.setEndPoint,t)},this),this.wallPointBtn.on(cc.Node.EventType.TOUCH_START,function(){console.log("setwallPointBtn"),t.node.targetOff(t),t.node.on(cc.Node.EventType.TOUCH_START,this.setWallPoint,t),t.node.on(cc.Node.EventType.TOUCH_MOVE,this.setWallPoint,t)},this),this.clearWallBtn.on(cc.Node.EventType.TOUCH_START,this.clearWallPoint,this),this.calculatePathBtn.on(cc.Node.EventType.TOUCH_START,this.calculatePath,this)},r.prototype.drawOneRect=function(t,r,i){var e=this.ctx,n=this.gridSize;e.rect(t,r,n.width,n.height),e.fillColor=i||new cc.Color(0,0,0),e.stroke(),e.fill()},r.prototype.drawOneSmallRect=function(t,r,i){var e=this.ctx,n=this.gridSize;e.rect(t,r,.6*n.width,.6*n.height),e.fillColor=i||new cc.Color(0,0,0),e.stroke(),e.fill()},r.prototype.updateGrids=function(){this.ctx.clear();for(var t=0;t<this.gridArray.length;t++)for(var r=0;r<this.gridArray[t].length;r++){var i=this.gridArray[t][r],e=i.pos,n=i.color;switch(i.type){case"wallPoint":n=cc.color(0,150,255);break;case"startPoint":n=cc.color(0,255,0);break;case"endPoint":n=cc.color(255,0,0);break;default:n=cc.color(0,0,0)}if(this.drawOneRect(e.x,e.y,n),i.process){switch(i.process){case"open":n=cc.color(255,255,0);break;case"close":n=cc.color(0,255,255)}this.drawOneSmallRect(e.x,e.y,n)}}},r.prototype.setStartPoint=function(t){for(var r=0;r<this.gridArray.length;r++)for(var i=0;i<this.gridArray[r].length;i++){"startPoint"==this.gridArray[r][i].type&&(this.gridArray[r][i].type="none");var e=this.gridArray[r][i].pos;new cc.Rect(e.x,e.y,this.gridSize.width,this.gridSize.height).contains(t.getLocation())&&(this.gridArray[r][i].type="startPoint",this.startPoint=cc.v2(r,i))}this.updateGrids();for(r=0;r<this.gridArray.length;r++)for(i=0;i<this.gridArray[r].length;i++)delete this.gridArray[r][i].process},r.prototype.setEndPoint=function(t){for(var r=0;r<this.gridArray.length;r++)for(var i=0;i<this.gridArray[r].length;i++){"endPoint"==this.gridArray[r][i].type&&(this.gridArray[r][i].type="none");var e=this.gridArray[r][i].pos;new cc.Rect(e.x,e.y,this.gridSize.width,this.gridSize.height).contains(t.getLocation())&&(this.gridArray[r][i].type="endPoint",this.endPoint=cc.v2(r,i))}this.updateGrids();for(r=0;r<this.gridArray.length;r++)for(i=0;i<this.gridArray[r].length;i++)delete this.gridArray[r][i].process},r.prototype.setWallPoint=function(t){for(var r=0;r<this.gridArray.length;r++)for(var i=0;i<this.gridArray[r].length;i++){var e=this.gridArray[r][i].pos;new cc.Rect(e.x,e.y,this.gridSize.width,this.gridSize.height).contains(t.getLocation())&&"none"==this.gridArray[r][i].type&&(this.gridArray[r][i].type="wallPoint")}this.updateGrids()},r.prototype.clearWallPoint=function(){for(var t=0;t<this.gridArray.length;t++)for(var r=0;r<this.gridArray[t].length;r++)"wallPoint"==this.gridArray[t][r].type&&(this.gridArray[t][r].type="none"),delete this.gridArray[t][r].process;this.updateGrids()},r.prototype.calculatePath=function(){var t=this;console.log("\u8ba1\u7b97\u8def\u5f84"),t.count=0;var r=new s(this.startPoint.x,this.startPoint.y,null),i=new s(this.endPoint.x,this.endPoint.y,null),e=new Array,n=[];e.push(r),console.log("openList",e),function r(o){if(t.count=t.count||0,t.count++,t.count>1e3)console.error("\u8d85\u8fc7\u6b21\u6570");else if(e.length>0){window.openList=e;for(var c=void 0,a=void 0,l=void 0,h=0,d=e;h<d.length;h++)a=(A=d[h]).F,(!c||c>a)&&(c=a,l=A);var y=e.indexOf(l);if(-1!=y?l=e.splice(y,1)[0]:console.log("no idx"),l.x==i.x&&l.y==i.y){console.log("\u627e\u5230\u4e86");for(var p=[],u=l;u.parent;)p.push(u.parent),u=u.parent;t.updateGrids()}else{delete t.gridArray[l.x][l.y].process,t.gridArray[l.x][l.y].process="close",n.push(l);for(var g=!1,f=function(r){var i=cc.v2(l.x+r.x,l.y+r.y);if(n.find(function(t,r){return t.x==i.x&&t.y==i.y}))return"continue";if(e.find(function(t,r){return t.x==i.x&&t.y==i.y}))return"continue";if(!t.gridArray[i.x]||!t.gridArray[i.x][i.y])return"continue";var o=t.gridArray[i.x][i.y];if("wallPoint"==o.type)return g=!0,"continue";var c,a,h=new s(o.row,o.col,l),d=10*cc.v2(r.x,r.y).mag();if(c=parseInt(d.toString()),g&&14==c)return"continue";var y=cc.v2(i.x,i.y).sub(t.endPoint);a=Math.abs(y.x)+Math.abs(y.y),h.F=c+10*a,h.G=c,h.H=a,h.dirX=y.x,h.dirY=y.y,e.push(h),delete t.gridArray[i.x][i.y].process,t.gridArray[i.x][i.y].process="open"},v=0,P=[cc.v2(0,1),cc.v2(0,-1),cc.v2(1,0),cc.v2(-1,0),cc.v2(1,1),cc.v2(1,-1),cc.v2(-1,1),cc.v2(-1,-1)];v<P.length;v++){var A;f(A=P[v])}t.scheduleOnce(function(){r(e),t.updateGrids()},t.playSpeed)}}else console.log("openList \u4e3a\u7a7a \u6ca1\u627e\u5230")}()},__decorate([o(cc.Node)],r.prototype,"ctxCanvas",void 0),__decorate([o(cc.Node)],r.prototype,"startPointBtn",void 0),__decorate([o(cc.Node)],r.prototype,"endPointBtn",void 0),__decorate([o(cc.Node)],r.prototype,"wallPointBtn",void 0),__decorate([o(cc.Node)],r.prototype,"calculatePathBtn",void 0),__decorate([o(cc.Node)],r.prototype,"clearWallBtn",void 0),r=__decorate([n],r)}(cc.Component);i.default=c;var s=function(){return function(t,r,i){this.x=null,this.y=null,this.F=null,this.G=null,this.H=null,this.dirX=null,this.dirY=null,this.parent=null,this.x=t,this.y=r,this.parent=i}}();cc._RF.pop()},{}]},{},["A_asterisk"]);